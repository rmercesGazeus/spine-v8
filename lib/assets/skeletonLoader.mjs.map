{"version":3,"file":"skeletonLoader.mjs","sources":["../../src/assets/skeletonLoader.ts"],"sourcesContent":["/** ****************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated July 28, 2023. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2023, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software or\r\n * otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THE\r\n * SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport {\r\n    type AssetExtension,\r\n    checkExtension,\r\n    DOMAdapter,\r\n    extensions,\r\n    ExtensionType,\r\n    LoaderParserPriority,\r\n    ResolvedAsset\r\n} from 'pixi.js';\r\n\r\ntype SkeletonJsonAsset = any;\r\ntype SkeletonBinaryAsset = Uint8Array;\r\n\r\nfunction isJson(resource: any): resource is SkeletonJsonAsset\r\n{\r\n    return Object.prototype.hasOwnProperty.call(resource, 'bones');\r\n}\r\n\r\nfunction isBuffer(resource: any): resource is SkeletonBinaryAsset\r\n{\r\n    return resource instanceof Uint8Array;\r\n}\r\n\r\nconst spineLoaderExtension: AssetExtension<SkeletonJsonAsset | SkeletonBinaryAsset> = {\r\n    extension: ExtensionType.Asset,\r\n\r\n    loader: {\r\n        extension: {\r\n            type: ExtensionType.LoadParser,\r\n            priority: LoaderParserPriority.Normal,\r\n            name: 'spineSkeletonLoader',\r\n        },\r\n\r\n        test(url)\r\n        {\r\n            return checkExtension(url, '.skel');\r\n        },\r\n\r\n        async load(url: string): Promise<SkeletonBinaryAsset>\r\n        {\r\n            const response = await DOMAdapter.get().fetch(url);\r\n\r\n            const buffer = new Uint8Array(await response.arrayBuffer());\r\n\r\n            return buffer;\r\n        },\r\n        testParse(asset: unknown, options: ResolvedAsset): Promise<boolean>\r\n        {\r\n            const isJsonSpineModel = checkExtension(options.src, '.json') && isJson(asset);\r\n            const isBinarySpineModel = checkExtension(options.src, '.skel') && isBuffer(asset);\r\n\r\n            return Promise.resolve(isJsonSpineModel || isBinarySpineModel);\r\n        },\r\n    },\r\n} as AssetExtension<SkeletonJsonAsset | SkeletonBinaryAsset>;\r\n\r\nextensions.add(spineLoaderExtension);\r\n"],"names":[],"mappings":";;AA0CA,SAAS,OAAO,QAChB,EAAA;AACI,EAAA,OAAO,MAAO,CAAA,SAAA,CAAU,cAAe,CAAA,IAAA,CAAK,UAAU,OAAO,CAAA,CAAA;AACjE,CAAA;AAEA,SAAS,SAAS,QAClB,EAAA;AACI,EAAA,OAAO,QAAoB,YAAA,UAAA,CAAA;AAC/B,CAAA;AAEA,MAAM,oBAAgF,GAAA;AAAA,EAClF,WAAW,aAAc,CAAA,KAAA;AAAA,EAEzB,MAAQ,EAAA;AAAA,IACJ,SAAW,EAAA;AAAA,MACP,MAAM,aAAc,CAAA,UAAA;AAAA,MACpB,UAAU,oBAAqB,CAAA,MAAA;AAAA,MAC/B,IAAM,EAAA,qBAAA;AAAA,KACV;AAAA,IAEA,KAAK,GACL,EAAA;AACI,MAAO,OAAA,cAAA,CAAe,KAAK,OAAO,CAAA,CAAA;AAAA,KACtC;AAAA,IAEA,MAAM,KAAK,GACX,EAAA;AACI,MAAA,MAAM,WAAW,MAAM,UAAA,CAAW,GAAI,EAAA,CAAE,MAAM,GAAG,CAAA,CAAA;AAEjD,MAAA,MAAM,SAAS,IAAI,UAAA,CAAW,MAAM,QAAA,CAAS,aAAa,CAAA,CAAA;AAE1D,MAAO,OAAA,MAAA,CAAA;AAAA,KACX;AAAA,IACA,SAAA,CAAU,OAAgB,OAC1B,EAAA;AACI,MAAA,MAAM,mBAAmB,cAAe,CAAA,OAAA,CAAQ,KAAK,OAAO,CAAA,IAAK,OAAO,KAAK,CAAA,CAAA;AAC7E,MAAA,MAAM,qBAAqB,cAAe,CAAA,OAAA,CAAQ,KAAK,OAAO,CAAA,IAAK,SAAS,KAAK,CAAA,CAAA;AAEjF,MAAO,OAAA,OAAA,CAAQ,OAAQ,CAAA,gBAAA,IAAoB,kBAAkB,CAAA,CAAA;AAAA,KACjE;AAAA,GACJ;AACJ,CAAA,CAAA;AAEA,UAAA,CAAW,IAAI,oBAAoB,CAAA"}